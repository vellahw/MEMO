# SQL 활용 - DDL(데이터 정의어)

## 1. 스키마 SCHEMA

```sql
CREATE SCHEMA 사용자명 AUTHORIZATION 사용자ID;
```

- 스키마란 데이터베이스의 구조와 제약조건에 관한 전반적인 명세를 기술한 것을 말한다.
- 데이터 개체, 속성, 관계 및 데이터 조작 시 데이터 값들이 갖는 제약조건 등에 관해 전반적으로 정의함.

## 2. 도메인 DOMAIN

```sql
CREATE DOMAIN 도메인명 [AS] 데이터타입
			[DEFAULT 기본값]
			[CONSTRAINT 제약조건명 CHECK(범위값)];

// [] 대괄호가 붙은 절은 생략 가능
```

- 하나의 속성이 취할 수 있는 동일한 유형의 원자값들의 집합을 의미함.
- 예를들어, 학년 속성의 데이터 타입은 정수이고 해당 속성에서 취할 수 있는 값의 범위가 1~4일 때
    - 1~4라는 범위는 해당 속성에 지정된 정수형의 모든 범위가 아니라 일부분이므로
    - 사용자는 1~4까지의 범위를 해당 속성의 도메인으로 사용할 수 있다는 의미이다.
- 도메인은 특정 속성에서 사용할 데이터 범위를 사용자가 정의하는 **사용자 정의 데이터 타입**이다.
- 정의된 도메인명은 일반적인 데이터 타입처럼 사용함

### 사용 예시

1. ‘성별’을 ‘남’ 또는 ‘여’와 같이 정해진 1개의 문자로 표현되는 도메인 SEX를 정의하라.
    
    ```sql
    CREATE DOMAIN SEX CHAR(1)
    			 DEFAULT '남' -- 기본값
    			 CONSTRAINT VALID-SEX CHECK('남', '여'); -- VALID-SEX: 제약조건명
    ```
    

✳️ **CHAR와 VARCHAR**

- CHAR는 항상 지정된 크기만큼 기억 장소과 확보된다
    - 예) CHAR(15)에 한 글자만 저장 되어도 15바이트가 확보됨.
- VARCHAR는 필드에 저장된 데이터 만큼만 기억 장소가 확보된다.
    - 예) VARCHAR(15)에 한 글자만 저장된다면 한 글자 크기 만큼만 확보됨.

## 3. 뷰 VIEW

- 테이블은 물리적으로 구현되어 실제로 데이터가 저장되지만 뷰는 물리적으로 구현되지 않는다.
- 뷰를 생성하면 뷰 정의가 시스템 내에 저장 되었다가 SQL 내에서 뷰 이름을 사용하면 실행시간에 뷰 정의가 대체되어 수행된다.

```sql
CREATE VIEW 뷰이름[(속성명, 속성명2, ...)]
AS SELECT문;
```

- SELECT문을 서브쿼리로 사용하여 SELECT문의 결과로서 뷰를 생성함
- 서브쿼리인 SELECT문에는 UNION이나 ORDER BY를 사용할 수 없다.
- 속성명을 기술하지 않으면 SELECT문의 속성명이 자동으로 사용됨

### 사용 예시

1. <고객> 테이블에서 ‘주소’가 ‘안산시’인 고객들의 ‘성명’과 ‘전화번호’를 ‘안산고객’이라는 뷰로 정의하라.

```sql
CREATE VIEW 안산고객(성명, 전화번호)
AS SELECT 성명, 전화번호
	 FROM 고객
	 WHERE 주소='안산시';
```

## 4. 인덱스 INDEX

- 검색 시간을 단축 시키기 위해 만든 보조적인 데이터 구조

```sql
CREATE [UNIQUE] INDEX 인덱스명
ON 테이블명(속성명 [ASC|DESC])
[CLUSTER];
```

- **UNIQUE**
    - 사용된 경우: 중복값이 없는 고유한 특성을 갖는 인덱스를 생성함
    - 생략된 경우: 중복값을 허용하는 인덱스를 생성함
- **CLUSTER**
    - 클러스터드 인덱스로 설정함
    
    ✳️ **클러스터드 인덱스**
    
    - 인덱스의 키의 순서에 따라 데이터가 정렬되어 저장됨
    - 실제 데이터가 순서대로 저장되어 있어 인덱스를 검색하지 않아도 원하는 데이터를 빠르게 찾을 수 있음.
    - 하지만 데이터 삽입, 삭제 발생 시 순서를 유지하기 위해 데이터를 재정렬 해야함.
    
    ✳️ **넌-클러스터드 인덱스**
    
    - 키값만 정렬될 뿐 데이터는 정렬되지 않음
    - 데이터 검색을 위해선 인덱스를 검사하여 실제 데이터의 위치를 확인해야한다.
    - 따라서 클러스터드 인덱스에 비해 검색 속도가 느림

## 5. ALTER TABLE

```sql
-- 테이블에 속성(컬럼) 추가
ALTER TABLE 테이블명 ADD 속성명 데이터타입;

-- 테이블의 속성(컬럼) 수정
ALTER TABLE 테이블명 ALTER 속성명 데이터타입;

-- 테이블의 속성(컬럼) 제거
ALTER TABLE 테이블명 DROP COLUMN 속성명 [CASCADE];
```

## 6. DROP

```sql
DROP SCHEMA 스키마명 [CASCADE|RESTRICT];
DROP DOMAIN 도메인명 [CASCADE|RESTRICT];
DROP VIEW 뷰명 [CASCADE|RESTRICT];
DROP INDEX 인덱스명 [CASCADE|RESTRICT];
DROP TABLE 테이블명 [CASCADE|RESTRICT];
DROP CONSTRAINT 제약조건명 [CASCADE|RESTRICT];
```

### ✳️ CASCADE

- 제거할 요소를 참조하는 다른 모든 개체를 함께 삭제
- 주 테이블의 데이터 제거 시 각 외래키와 관계를 맺고 있는 모든 데이터를 제거함 (참조 무결성 제약 조건)

### ✳️ RESTRICT

- 다른 개체가 제거할 요소를 참조 중일 때는 제거를 취소함